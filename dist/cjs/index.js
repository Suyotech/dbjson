var d=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var m=(s,t)=>{for(var e in t)d(s,e,{get:t[e],enumerable:!0})},E=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of w(t))!y.call(s,n)&&n!==e&&d(s,n,{get:()=>t[n],enumerable:!(r=p(t,n))||r.enumerable});return s};var g=s=>E(d({},"__esModule",{value:!0}),s);var $={};m($,{Model:()=>l,Schema:()=>u});module.exports=g($);var c=class{constructor(t){this.#t=t}#t=null;properties(){return Object.keys(Object)}validate(t){let e=this.#t;if(!t||!e)throw new Error("Data and schema are required for validation.");for(let r in e){let{type:n,required:i,default:o}=e[r],a=t[r];if(i&&a==null)if(o!==void 0)t[r]=o;else throw new Error(`Required field '${r}' is missing`);if(i&&n===String&&a==="")throw new Error(`Required field '${r}' cannot be empty`);switch(!i&&a===""&&(a=void 0),n){case String:if(a!==void 0&&typeof a!="string")throw new Error(`Invalid type at '${r}'. Expected String.`);break;case Number:if(a!==void 0&&typeof a!="number")throw new Error(`Invalid type at '${r}'. Expected Number.`);break;case Boolean:if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid type at '${r}'. Expected Boolean.`);break;case Object:if(a!==void 0&&(typeof a!="object"||Array.isArray(a)))throw new Error(`Invalid type at '${r}'. Expected Object.`);break;case Array:if(a!==void 0&&!Array.isArray(a))throw new Error(`Invalid type at '${r}'. Expected Array.`);break;case Date:if(a!==void 0){if(a=new Date(a),isNaN(a.getTime()))throw new Error(`Invalid date format at '${r}'.`);t[r]=a}break;default:throw new Error(`Unsupported type at '${r}'.`)}}}},u=c;var h=class{constructor(t,e,r){if(!t||!e||!(r instanceof Schema)||!r)throw new Error("Invalid schema or collection name");this.#i=path.join(e,`${t}.json`),this.#t=r,this.#a()}#t=null;#i=null;#a(){fs.existsSync(this.#i)||fs.writeFileSync(this.#i,JSON.stringify([]),"utf-8");let t=this.#t}#e(){return JSON.parse(fs.readFileSync(this.#i,"utf-8"))}#r(t){fs.writeFileSync(this.#i,JSON.stringify(t),"utf-8")}createOne(t){try{this.#t.validate(t);let e=this.#e();return t.id=crypto.randomUUID(),e.push(t),this.#r(e),t}catch(e){throw console.error("Error creating document:",e),e}}insertMany(t){try{t.forEach(r=>this.#t.validate(r)),t.forEach(r=>r.id=r.id=crypto.randomUUID());let e=this.#e();return e.push(...t),this.#r(e),t}catch(e){throw console.error("Error inserting documents:",e),e}}find(t){try{let r=this.#e().filter(n=>this.#n(n,t));return new f(r,this.#t)}catch(e){throw console.error("Error finding documents:",e),e}}findOne(t){try{return this.#e().find(r=>this.#n(r,t))||null}catch(e){throw console.error("Error finding document:",e),e}}findAndDeleteOne(t){try{let e=this.#e(),r=e.findIndex(n=>this.#n(n,t));if(r!==-1){let n=e.splice(r,1)[0];return this.#r(e),n}throw new Error("Document not found")}catch(e){throw console.error("Error finding and deleting document:",e),e}}findOneAndUpdate(t,e){try{let r=this.#e(),n=null,i=r.map(o=>{if(this.#n(o,t)){let a={...o,...e};return n=a,a}return o});if(n)return this.#r(i),n;throw new Error("Document not found")}catch(r){throw console.error("Error finding and updating document:",r),r}}updateMany(t,e){try{let n=this.#e().map(i=>this.#n(i,t)?{...i,...e}:i);return this.#r(n),n}catch(r){throw console.error("Error updating documents:",r),r}}deleteMany(t){try{let r=this.#e().filter(n=>!this.#n(n,t));return this.#r(r),r}catch(e){throw console.error("Error deleting documents:",e),e}}#n(t,e){for(let r in e){let n=e[r],i=t[r];if(typeof n=="object"&&n!==null)for(let o in n)switch(o){case"$in":if(!n.$in.includes(i))return!1;break;case"$nin":if(n.$nin.includes(i))return!1;break;case"$lte":if(i>n.$lte)return!1;break;case"$gte":if(i<n.$gte)return!1;break;case"$eq":if(i!==n.$eq)return!1;break;case"$ne":if(i===n.$ne)return!1;break;default:return!1}else if(n!==i)return!1}return!0}},f=class{constructor(t,e){this.data=t,this.schema=e,console.log("schema value",this.schema),this.#t()}#t(){if(!Array.isArray(this.data))throw new Error("Invalid data for operation");this.data.forEach(t=>this.validateObject(t))}validateObject(t){for(let e in this.schema){let{type:r,required:n,default:i}=this.schema[e];if(n&&!t.hasOwnProperty(e))throw new Error(`Missing required property "${e}"`);if(t.hasOwnProperty(e)){if(typeof t[e]!==r.name.toLowerCase())throw new Error(`Invalid type for property "${e}". Expected ${r.name}`)}else i!==void 0&&(t[e]=i)}}sort(t){if(this.data.length===0)return this;for(let e in t){let r=t[e];if(r!==1&&r!==-1)throw new Error(`Invalid sort operator "${r}" for key "${e}". Use 1 for ascending, -1 for descending.`);this.data.sort((n,i)=>r===1?n[e]-i[e]:r===-1?i[e]-n[e]:0)}return this}limit(t){return this.data=this.data.slice(0,t),this}skip(t){return this.data=this.data.slice(t),this}select(t){let e=Object.keys(t).filter(n=>t[n]===1),r=Object.keys(t).filter(n=>t[n]===0);return e.length===0?this.data=this.data.map(n=>{let i={};for(let o in n)(!t.hasOwnProperty(o)||t[o]===1)&&(i[o]=n[o]);return i}):this.data=this.data.map(n=>{let i={};return e.forEach(o=>{n.hasOwnProperty(o)&&(i[o]=n[o])}),i}),r.forEach(n=>{this.data.forEach(i=>{delete i[n]})}),this}distinct(t){let e=new Set;return this.data.forEach(r=>{r[t]&&e.add(r[t])}),this.data=Array.from(e),this}count(){return this.data=this.data.length,this}exec(){return this.data}},l=h;
//# sourceMappingURL=index.js.map
